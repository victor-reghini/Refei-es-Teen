<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8">
    <title>Controle de Refei√ß√µes</title>
    <style>
      body{font-family:Arial;background:#f5f7fb;padding:20px}
      .container{max-width:900px;margin:auto;background:white;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
      h2{margin-top:0}
      input,select,textarea{width:100%;padding:8px;margin:6px 0;border-radius:8px;border:1px solid #ccc}
      button{padding:8px 14px;border:none;border-radius:8px;cursor:pointer}
      .primary{background:#4f7cff;color:white}
      .danger{background:#ff5c5c;color:white}
      .table{width:100%;border-collapse:collapse;margin-top:20px}
      .table th,.table td{border:1px solid #ddd;padding:6px;text-align:center}
      .table th{background:#eef2ff}
    </style>
  </head>
  <body>
    <div class="container">
    <h2>Registro de Refei√ß√µes</h2>
    <form id="form">
      <input type="hidden" id="id">
      
      <label>Data</label>
      <input type="date" id="data" required>
      
      <label>Refei√ß√£o</label>
      <select id="refeicao">
        <option>Almo√ßo</option>
        <option>Jantar</option>
        <option>Caf√©</option>
        <option>Lanche</option>
      </select>
        
      <label>Contagem Refeit√≥rio</label>
      <input type="number" id="refeitorio">
        
      <label>Contagem Gastronomia</label>
      <input type="number" id="gastronomia">

      <div style="display: flex; justify-content: left; align-items: center">
        <label for="cardapio">Card√°pio conforme previsto</label>
        <input type="checkbox" id="cardapio">
      </div>
      
        
      <label>Observa√ß√µes</label>
      <textarea id="obs"></textarea>
        
      <button class="primary" type="submit">Salvar</button>
    </form>
    
    <table class="table" id="tabela">
      <thead>
        <tr>
          <th>Data</th>
          <th>Refei√ß√£o</th>
          <th>Refeit√≥rio</th>
          <th>Gastronomia</th>
          <th>Card√°pio</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    </div>
  
    <script>
      const API_URL = "https://script.google.com/macros/s/AKfycbyWgdtSY_-6y14_2hkri3StGHkopA68ErAYf5j804YFSr6EBbefJJuzEKip1FUpPe6cqA/exec";
      
      async function api_fetch(method,body=null){
        return fetch(API_URL,{method:method,body:body?JSON.stringify(body):null})
          .then(r=>r.json());
      }
      async function api(action, body=null){
        return fetch(API_URL,{
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ _method: action, ...body })
        }).then(r=>r.json());
      }
      
      async function listar(){
        const data = await api_fetch('GET');
        const tbody=document.querySelector('#tabela tbody');
        tbody.innerHTML='';
        data.forEach(r=>{
          var date = new Date(r.Data);
          tbody.innerHTML+=`<tr>
            <td>${date.toLocaleDateString('pt-BR')}</td>
            <td>${r['Refei√ß√£o']}</td>
            <td>${r['Contagem Refeit√≥rio']}</td>
            <td>${r['Contagem Gastronomia']}</td>
            <td>${r['Card√°pio OK']=='true'?'‚úî':'‚úñ'}</td>
            <td>
            <button onclick='editar(${JSON.stringify(r)})'>‚úè</button>
            <button class="danger" onclick='remover(${r.ID})'>üóë</button>
            </td></tr>`;
        });
      }
      
      function editar(r){
        var date = new Date(r.Data);
        id.value=r.ID;
        data.value=date.format('yyyy-mm-dd');
        refeicao.value=r['Refei√ß√£o'];
        refeitorio.value=r['Contagem Refeit√≥rio'];
        gastronomia.value=r['Contagem Gastronomia'];
        cardapio.checked=r['Card√°pio OK']=='true';
        obs.value=r['Anota√ß√µes'];
      }
      
      async function remover(id){
        await api('DELETE',{ID:id});
        listar();
      }
      
      form.onsubmit=async e=>{
        e.preventDefault();
        const payload={
          ID:id.value,
          Data:data.value,
          'Refei√ß√£o':refeicao.value,
          'Contagem Refeit√≥rio':refeitorio.value,
          'Contagem Gastronomia':gastronomia.value,
          'Card√°pio OK':cardapio.checked,
          'Anota√ß√µes':obs.value
        };
        
        if(id.value) await api('UPDATE',payload);
          
        else await api('CREATE',payload);
        
        form.reset();
        listar();
      }
      
      listar();
    </script>
  </body>
</html>
